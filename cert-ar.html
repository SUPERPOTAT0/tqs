<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>البحث عن شهادة - TQS</title>
    <!-- Favicon -->
    <link rel="icon" href="logo.png" type="image/png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #fcfcfc; /* Light off-white */
            color: #333;
        }
        /* Logo Colors */
        .text-primary { color: #8B0000; } /* Deep Red/Maroon */
        .bg-primary { background-color: #8B0000; }
        .hover\:bg-primary-dark:hover { background-color: #6a0000; }
        .border-primary { border-color: #8B0000; }
        .focus\:ring-primary:focus {
            --tw-ring-color: #8B0000;
        }
         .focus\:border-primary:focus {
             border-color: #8B0000;
        }

        .text-secondary { color: #B8860B; } /* Gold */
        .bg-secondary { background-color: #B8860B; }
        .hover\:bg-secondary-dark:hover { background-color: #a0720a; }
        .border-secondary { border-color: #B8860B; }

        /* Simple spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, .1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #8B0000; /* Use primary color for spinner */
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Mobile menu styling */
        .mobile-menu {
            transition: transform 0.3s ease-in-out;
            transform: translateX(100%);
        }
        .mobile-menu.open {
            transform: translateX(0%);
        }
        
        /* Scroll Animation (for consistency) */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.8s ease-out 0.2s forwards;
        }
    </style>
</head>
<body class="bg-fcfcfc min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white shadow-lg sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <!-- Logo -->
            <a href="index-ar.html" class="flex items-center space-x-2 space-x-reverse">
                <img src="logo.png" alt="TQS Logo" class="h-12 w-auto">
            </a>
            
            <!-- Navigation Links (Desktop) -->
            <div class="hidden md:flex space-x-8 space-x-reverse items-center text-lg">
                <a href="index-ar.html" class="text-gray-700 hover:text-primary transition duration-300">الرئيسية</a>
                <a href="cert-ar.html" class="text-primary font-semibold border-b-2 border-primary pb-1">البحث عن شهادة</a>
                <a href="contact-ar.html" class="text-gray-700 hover:text-primary transition duration-300">اتصل بنا</a>
            </div>

            <!-- Language Switcher -->
            <div class="hidden md:block">
                <a href="cert-en.html" class="text-sm bg-secondary text-white py-2 px-4 rounded-full hover:bg-secondary-dark transition duration-300 shadow-md">
                    English (EN)
                </a>
            </div>

            <!-- Mobile Menu Button -->
            <div class="md:hidden flex items-center">
                <button id="mobileMenuButton" class="text-primary focus:outline-none">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </nav>

        <!-- Mobile Menu Overlay -->
        <div id="mobileMenu" class="mobile-menu fixed top-0 right-0 w-64 h-full bg-white shadow-xl z-50 p-6 md:hidden flex flex-col items-start space-y-6">
            <button id="closeMobileMenuButton" class="self-end text-primary focus:outline-none">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <a href="index-ar.html" class="text-gray-700 hover:text-primary transition duration-300 text-xl">الرئيسية</a>
            <a href="cert-ar.html" class="text-primary font-semibold border-b-2 border-primary pb-1 text-xl">البحث عن شهادة</a>
            <a href="contact-ar.html" class="text-gray-700 hover:text-primary transition duration-300 text-xl">اتصل بنا</a>
            <div class="border-t border-gray-200 w-full pt-4">
                <a href="cert-en.html" class="block text-secondary py-2 px-4 rounded-full border border-secondary text-center hover:bg-secondary hover:text-white transition duration-300 mt-4 text-xl">
                    English (EN)
                </a>
            </div>
        </div>
    </header>

    <!-- Search Section -->
    <main class="container mx-auto px-6 py-16 flex-grow flex items-center justify-center">
        <div class="max-w-2xl mx-auto bg-white p-8 md:p-12 rounded-xl shadow-2xl text-center border-t-4 border-primary animate-on-scroll">
            <h1 class="text-3xl md:text-4xl font-extrabold text-primary mb-4">التحقق من صحة الشهادة</h1>
            <p class="text-lg text-gray-700 mb-8">الرجاء إدخال رقم الشهادة للتحقق من حالتها وسلامتها.</p>

            <div class="flex flex-col sm:flex-row gap-4 mb-6">
                <input type="text" id="certNumberInput" inputmode="numeric" pattern="[0-9]*" class="flex-grow p-4 border border-gray-300 rounded-lg text-lg text-right focus:ring-2 focus:ring-primary focus:border-primary transition duration-200 shadow-sm" placeholder="أدخل رقم الشهادة هنا...">
                <button id="searchButton" class="bg-primary text-white py-4 px-10 rounded-lg text-lg font-semibold hover:bg-primary-dark transition duration-300 shadow-md">
                    بحث
                </button>
            </div>
            
            <!-- JavaScript-only input restriction -->
            <p id="inputError" class="text-red-600 mt-2 text-sm hidden text-right font-medium">الرجاء إدخال أرقام فقط.</p>

            <!-- Results Area -->
            <div id="resultsArea" class="mt-10 min-h-[150px]">
                <!-- Loading Spinner -->
                <div id="loadingSpinner" class="hidden spinner mx-auto"></div>

                <!-- Error Message -->
                <div id="errorMessage" class="hidden p-4 bg-red-100 text-red-700 rounded-lg font-medium border border-red-200">
                    <!-- Message will be set by JS -->
                </div>

                <!-- Success Message -->
                <div id="successMessage" class="hidden p-4 bg-green-100 text-green-800 rounded-lg font-medium border border-green-200">
                    <h3 class="font-bold text-xl mb-2">تم العثور على الشهادة!</h3>
                    <p class="mb-4">تم التحقق من الشهادة بنجاح. يمكنك عرضها أو تحميلها من الرابط أدناه.</p>
                    <a id="certLink" href="#" target="_blank" class="inline-flex items-center bg-green-600 text-white py-3 px-8 rounded-full hover:bg-green-700 transition duration-300 shadow-md">
                        عرض الشهادة (PDF)
                        <svg class="inline-block h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                    </a>
                </div>
            </div>
        </div>
    </main>
    
    <script>
        // *** Your Web App URL is pre-filled ***
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxgxCbWCuh51rPttyibapuv4NFV3YNoVH17i6qOuj5oFQc82OXFDFjZud1NZPZPBurJ/exec";
        // ***************************************

        const searchButton = document.getElementById('searchButton');
        const certNumberInput = document.getElementById('certNumberInput');
        const resultsArea = document.getElementById('resultsArea');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const certLink = document.getElementById('certLink');
        const inputError = document.getElementById('inputError');

        // Input validation: Only allow numbers
        certNumberInput.addEventListener('input', function(e) {
            const regex = /^[0-9]*$/;
            if (!regex.test(e.target.value)) {
                e.target.value = e.target.value.replace(/[^0-9]/g, '');
                inputError.classList.remove('hidden');
                inputError.textContent = "الرجاء إدخال أرقام فقط.";
            } else {
                inputError.classList.add('hidden');
            }
        });

        searchButton.addEventListener('click', function() {
            const certNumber = certNumberInput.value.trim();

            // Reset UI
            loadingSpinner.classList.add('hidden');
            errorMessage.classList.add('hidden');
            successMessage.classList.add('hidden');
            inputError.classList.add('hidden');

            // Check for empty input
            if (certNumber === "") {
                inputError.textContent = "الرجاء إدخال رقم الشهادة.";
                inputError.classList.remove('hidden');
                return;
            }
            
            // Check for non-numeric input (double check)
            if (!/^[0-9]+$/.test(certNumber)) {
                inputError.textContent = "الرجاء إدخال أرقام فقط.";
                inputError.classList.remove('hidden');
                return;
            }

            // Show spinner and start search
            loadingSpinner.classList.remove('hidden');
            
            // Construct the URL with query parameter
            const searchUrl = `${WEB_APP_URL}?certNumber=${certNumber}`;

            // Make the API call to Google Apps Script
            fetch(searchUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Network response was not ok: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    loadingSpinner.classList.add('hidden');
                    
                    if (data.status === "found") {
                        // Success: Certificate found
                        certLink.href = data.fileUrl;
                        successMessage.classList.remove('hidden');
                    } else if (data.status === "not_found") {
                        // Error: Certificate not found
                        errorMessage.textContent = "لم يتم العثور على شهادة بهذا الرقم. الرجاء التأكد من الرقم والمحاولة مرة أخرى.";
                        errorMessage.classList.remove('hidden');
                    } else {
                        // Other error from the script
                        throw new Error(data.message || 'Unknown error from script');
                    }
                })
                .catch(error => {
                    // Handle fetch errors (network, script error, etc.)
                    console.error('Fetch Error:', error);
                    loadingSpinner.classList.add('hidden');
                    errorMessage.textContent = "حدث خطأ أثناء الاتصال بالخادم. الرجاء المحاولة مرة أخرى لاحقاً.";
                    errorMessage.classList.remove('hidden');
                });
        });

        // Mobile menu functionality
        const mobileMenuButton = document.getElementById('mobileMenuButton');
        const closeMobileMenuButton = document.getElementById('closeMobileMenuButton');
        const mobileMenu = document.getElementById('mobileMenu');

        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('open');
        });

        closeMobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.remove('open');
        });
    </script>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-10 mt-auto">
        <div class="container mx-auto px-6 text-center">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <div class="mb-4 md:mb-0">
                     <img src="logo.png" alt="TQS Logo" class="h-14 w-auto mx-auto">
                </div>
                <div class="flex space-x-6 space-x-reverse text-lg">
                    <a href="index-ar.html" class="hover:text-primary transition duration-300">الرئيسية</a>
                    <a href="cert-ar.html" class="hover:text-primary transition duration-300">البحث عن شهادة</a>
                    <a href="contact-ar.html" class="hover:text-primary transition duration-300">اتصل بنا</a>
                </div>
            </div>
            <p class="text-gray-400">&copy; 2025 تريند لأنظمة الجودة (TQS). جميع الحقوق محفوظة.</p>
        </div>
    </footer>

</body>
</html>